{% extends "layout.html" %}
{% block content %}
<div class="container mt-1">
  <div id="carouselExampleIndicators" class="carousel slide mb-3" data-ride="carousel">
    <ol class="carousel-indicators">
      <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
    </ol>
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img class="d-block w-100" src="static/carousel/1.jpeg" alt="First slide">
      </div>
      <div class="carousel-item">
        <img class="d-block w-100" src="static/carousel/2.jpeg" alt="Second slide">
      </div>
      <div class="carousel-item">
        <img class="d-block w-100" src="static/carousel/3.jpeg" alt="Third slide">
      </div>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>

   <div class="row">
    {% if posts %}
      {% set post_count = 0 %}
      {% for post in posts.items %}
        {% if post_count < 6 %}
          <div class="col-md-4 mb-4">
          <div class="card box-shadow" style="height: 100%;">
            {% if post.image_file %}
              <img class="card-img-top" src="{{ url_for('static', filename='post_images/' + post.image_file) }}" alt="post image">
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title"><a href="{{ url_for('posts.post', post_id=post.id) }}" class="post-title">{{ post.title }}</a></h5>
              <div class="card-text" style="height: 100px; overflow: auto;">
                {{ post.content }}
              </div>
              <div class="d-flex justify-content-between align-items-center mt-3 mt-auto">
                <div class="btn-group">
                  {% if post.author != current_user %}
                    <form action="{{ url_for('main.payment_information') }}" method="GET">
                      <input type="hidden" name="post_id" value="{{ post.id }}">
                      <button type="submit" class="btn btn-sm btn-outline-primary">Buy</button>
                    </form>
                  {% else %}
                    <a href="{{ url_for('posts.update_post', post_id=post.id) }}" class="btn btn-sm btn-outline-secondary">Update</a>
                    <button type="button" class="btn btn-sm btn-outline-danger" data-toggle="modal" data-target="#deleteModal">Delete</button>
                  {% endif %}
                  <a href="{{ url_for('posts.post', post_id=post.id) }}" class="btn btn-sm btn-outline-info">Show More</a>
                </div>
                <small class="text-muted">${{ post.price }}</small>
              </div>
            </div>
          </div>
        </div>
       {% set post_count = post_count + 1 %}
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>


  <nav aria-label="Page navigation">
    <ul class="pagination">
     {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
        {% if page_num %}
          {% if posts.page == page_num %}
            <li class="page-item active"><a class="page-link" href="{{ url_for('main.home', page=page_num) }}">{{ page_num }}</a></li>
          {% else %}
            <li class="page-item"><a class="page-link" href="{{ url_for('main.home', page=page_num) }}">{{ page_num }}</a></li>
          {% endif %}
        {% else %}
          <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %}
      {% endfor %}
    </ul>
  </nav>
</div>
{% endblock content %}
